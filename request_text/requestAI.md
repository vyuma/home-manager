# 本の管理アプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 目的
自宅の大量の本を効率的に管理し、毎年の蔵書点検を最適化するためのWebアプリケーション。本の所在地・読書状況を一元管理し、「あの本はどこにあるか」「読んだかどうか」を即座に把握できるようにする。

### 1.2 対象ユーザー
- 自宅に大量の本を所有している個人
- 定期的に蔵書点検を行いたい人
- 欲しい本リストを管理したい人
- 読書履歴を記録したい人

### 1.3 システム構成
- **フレームワーク**: Next.js 16 (App Router) + React 19 + Tailwind CSS 4
- **バックエンド**: Next.js Server Actions
- **認証**: NextAuth.js v5 (Auth.js) + Google OAuth
- **データベース**: PostgreSQL 16 + Prisma 7
- **外部API**: Google Books API
- **AI機能**: SLM（Small Language Model）による感想自動生成
- **インフラ**: Docker / Docker Compose

---

## 2. 本のセグメント分類

### 2.1 所在地による分類（Location Status）

| ステータス | 説明 | 親要素 |
|-----------|------|--------|
| WANTED | 欲しい本（まだ持っていない） | なし |
| UNSHELVED | 購入済み・未確定（本棚未配置） | なし |
| OWNED | 家にある本（本棚に配置済み） | 本棚（Bookshelf） |
| READ_NOT_OWNED | 家にはないが読んだ本 | 場所（Location） |
| PREVIOUSLY_WANTED | 過去に欲しかった本（削除済み） | なし |

### 2.3 本のライフサイクル

```
欲しい本 ──[購入]──→ 未確定の本 ──[本棚に配置]──→ 本棚の本
   │                    │                         │
   │                    │                         │
   └──[削除]──→ 過去に欲しかった本    └──[手放す]──→ 読んだ本
```

### 2.2 読書状況による分類（Reading Status）

| ステータス | 説明 |
|-----------|------|
| NOT_READ | 読んでいない |
| READING | 読書中（少しだけ読んだ） |
| COMPLETED | 読了 |

---

## 3. データモデル

### 3.1 ER図概要

```
User (ユーザー)
  ├── WantedBook (欲しい本)
  │     └── Book
  ├── UnshelvedBook (未確定の本：購入済み・本棚未配置)
  │     └── Book
  ├── Bookshelf (本棚)
  │     └── OwnedBook (所有本)
  │           └── Book
  └── Location (場所：家以外)
        └── ReadBook (読んだ本)
              └── Book
```

### 3.2 モデル詳細

| モデル | フィールド | 説明 |
|--------|-----------|------|
| **User** | id, email, name, image, emailVerified, createdAt, updatedAt | ユーザー情報（NextAuth管理） |
| **Account** | id, userId, provider, providerAccountId, ... | OAuth連携情報（NextAuth） |
| **Session** | id, userId, sessionToken, expires | セッション情報（NextAuth） |
| **Book** | id, isbn, title, subtitle, authors, publisher, publishedDate, description, coverImageUrl, categories, pageCount, createdAt, updatedAt | 書籍マスタ情報（Google Books APIから取得） |
| **Bookshelf** | id, name, memo, userId, createdAt, updatedAt | 本棚 |
| **OwnedBook** | id, bookId, bookshelfId, userId, readingStatus, note, createdAt, updatedAt | 本棚に配置済みの本 |
| **UnshelvedBook** | id, bookId, userId, readingStatus, note, createdAt, updatedAt | 未確定の本（購入済み・本棚未配置） |
| **WantedBook** | id, bookId, userId, isActive, createdAt, updatedAt | 欲しい本リスト |
| **Location** | id, name, userId, createdAt, updatedAt | 家以外の場所（図書館など） |
| **ReadBook** | id, bookId, locationId, userId, readingStatus, note, createdAt, updatedAt | 家にはないが読んだ本 |
| **AutoReview** | id, bookId, generatedText, createdAt | SLMによる自動生成感想 |

---

## 4. 機能要件

### 4.1 認証機能（NextAuth + Google OAuth）

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| AUTH-001 | Googleログイン | Googleアカウントでログイン/新規登録 | 高 |
| AUTH-002 | ログアウト | セッションを終了してログアウト | 高 |
| AUTH-003 | セッション管理 | NextAuthによる自動セッション管理 | 高 |
| AUTH-004 | 認証ガード | 未ログイン時はログイン画面にリダイレクト | 高 |

### 4.2 本の登録機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| BOOK-001 | ISBNバーコード読み取り | カメラでバーコードをスキャンしてISBNを取得 | 高 |
| BOOK-002 | ISBN手動入力 | ISBNコードを手動で入力 | 高 |
| BOOK-003 | Google Books API連携 | ISBNからタイトル・著者・表紙等を自動取得 | 高 |
| BOOK-004 | 本棚選択 | 登録先の本棚を選択（ユーザー入力はこれのみ） | 高 |
| BOOK-005 | 手動登録（ISBNなし） | タイトル・著者名を入力（ISBNがない本のみ） | 中 |

※ユーザー入力を最小化：ISBN読み取り → 自動取得 → 本棚選択 → 登録完了

### 4.3 欲しい本管理機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| WANT-001 | 欲しい本登録 | バーコード読み取り/手動入力で欲しい本を登録 | 高 |
| WANT-002 | 欲しい本一覧表示 | 欲しい本の一覧を表示 | 高 |
| WANT-003 | ワンタッチ購入 | 欲しい本をワンタッチで「未確定の本」に移動 | 高 |
| WANT-004 | 欲しい本削除 | 欲しい本リストから削除（過去に欲しかった本として保存） | 高 |

### 4.4 未確定の本管理機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| UNSHELF-001 | 未確定の本一覧表示 | ダッシュボードに未確定の本を表示 | 高 |
| UNSHELF-002 | 本棚への配置 | 未確定の本を本棚に配置 | 高 |
| UNSHELF-003 | 読書状況設定 | 未確定の本の読書状況を設定 | 中 |
| UNSHELF-004 | 未確定の本削除 | 未確定の本を削除（読んだ本として保存可能） | 中 |

### 4.5 本棚管理機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| SHELF-001 | 本棚作成 | 新しい本棚を作成（マルチセレクトで新規追加可能） | 高 |
| SHELF-002 | 本棚一覧表示 | 本棚の一覧を表示 | 高 |
| SHELF-003 | 本棚編集 | 本棚名・メモを編集 | 高 |
| SHELF-004 | 本棚削除 | 本棚と紐づく本の関連を削除 | 中 |
| SHELF-005 | 本棚メモ登録 | 本棚に対するメモを登録・編集 | 中 |

### 4.6 蔵書点検機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| INV-001 | 蔵書点検モード | 本棚を選択して蔵書点検を開始 | 高 |
| INV-002 | 連続バーコード読み取り | 蔵書点検中に連続でバーコードをスキャン | 高 |
| INV-003 | 本棚への本登録 | スキャンした本を選択中の本棚に登録 | 高 |
| INV-004 | 読書状況設定 | 登録時に読書状況（未読/読書中/読了）を設定 | 高 |

### 4.7 本の確認・閲覧機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| VIEW-001 | 本棚別本一覧 | 選択した本棚に属する本の一覧を表示 | 高 |
| VIEW-002 | 全体検索 | 全ての本からタイトル・著者で検索 | 高 |
| VIEW-003 | 本詳細モーダル | 本の表紙タップで詳細情報をモーダル表示 | 高 |
| VIEW-004 | 本情報編集 | 本棚・読書状況・メモのみ編集可能 | 高 |
| VIEW-005 | フィルタリング | 読書状況・カテゴリでフィルタリング | 中 |

※詳細モーダルで編集可能な項目は「本棚」「読書状況」「メモ」の3つのみ

### 4.8 本の移動機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| MOVE-001 | 本棚間移動 | 本を別の本棚に移動 | 高 |
| MOVE-002 | 欲しい本→未確定 | 欲しい本を購入して「未確定の本」に移動（ワンタッチ） | 高 |
| MOVE-003 | 未確定→本棚 | 未確定の本を本棚に配置 | 高 |
| MOVE-004 | 本棚→読んだ本 | 本棚から削除し、「読んだ本」として保存 | 高 |

### 4.9 本の削除機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| DEL-001 | 本棚から削除 | 本棚からは削除、「家にはないが読んだ本」として残る | 高 |
| DEL-002 | 欲しい本から削除 | 欲しい本リストから削除、「過去に欲しかった本」として残る | 高 |
| DEL-003 | 完全削除 | 本を完全に削除（全ての関連を削除） | 中 |
| DEL-004 | 削除確認ダイアログ | 削除種別を選択できる確認ダイアログ | 高 |

### 4.10 AI機能（アドバンスド）

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| AI-001 | 自動感想生成 | 本のタイトル・カテゴリからSLMで50字の感想を自動生成 | 低 |
| AI-002 | 感想表示 | 生成された感想を本の詳細画面に表示 | 低 |
| AI-003 | 感想再生成 | ユーザーの操作で感想を再生成 | 低 |

### 4.11 情報コピー・読書マラソン機能

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| COPY-001 | 著者名コピー | 本の著者名をクリップボードにコピー | 中 |
| COPY-002 | 書名コピー | 本のタイトルをクリップボードにコピー | 中 |
| COPY-003 | 出版社コピー | 本の出版社をクリップボードにコピー | 中 |
| COPY-004 | ISBNコピー | 本のISBNをクリップボードにコピー | 中 |
| MARATHON-001 | 読書マラソン投稿チェック | 読書マラソンに投稿済みかどうかのチェックボックス | 中 |
| MARATHON-002 | 投稿状況フィルタリング | 読書マラソン投稿済み/未投稿でフィルタリング | 低 |

※詳細モーダルに各項目の横にコピーボタンを表示。読書マラソンチェックボックスも詳細モーダルに配置。

### 4.12 UI/UX要件

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| UI-001 | レスポンシブデザイン | PC・タブレット・スマートフォンに対応 | 高 |
| UI-002 | ダークモード | ライト/ダークモードの切り替え | 低 |
| UI-003 | ナビゲーション | 現在の画面位置を表示 | 中 |
| UI-004 | ローディング表示 | データ取得中のローディングインジケーター | 中 |
| UI-005 | エラーハンドリング | エラー発生時の適切なメッセージ表示 | 高 |
| UI-006 | トースト通知 | 操作完了時の通知表示 | 中 |

---

## 5. 画面一覧

| 画面ID | 画面名 | パス | 説明 |
|--------|--------|------|------|
| SCR-001 | ログイン | `/login` | Googleログインボタン表示 |
| SCR-002 | ダッシュボード | `/` | **未確定の本**・本棚一覧・統計表示 |
| SCR-003 | 欲しい本一覧 | `/wanted` | 欲しい本リスト |
| SCR-004 | 本棚詳細 | `/shelves/[shelfId]` | 本棚内の本一覧 |
| SCR-005 | 蔵書点検 | `/inventory` | 蔵書点検モード |
| SCR-006 | 本登録 | `/books/new` | 新規本登録フォーム |
| SCR-007 | 検索結果 | `/search` | 検索結果表示 |
| SCR-008 | 読んだ本一覧 | `/read` | 家にはないが読んだ本 |
| SCR-009 | 設定 | `/settings` | ユーザー設定 |

---

## 6. API エンドポイント

### 6.1 認証系（NextAuth自動生成）
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET/POST | `/api/auth/[...nextauth]` | NextAuth.js認証エンドポイント（自動生成） |
| GET | `/api/auth/session` | セッション情報取得 |
| GET | `/api/auth/signin` | サインインページ |
| POST | `/api/auth/signout` | サインアウト |

### 6.2 書籍マスタ系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/books/search?isbn=` | ISBNで書籍情報取得（Google Books API経由） |
| GET | `/api/books/search?q=` | タイトル・著者で検索 |
| POST | `/api/books` | 書籍マスタ登録（手動） |
| GET | `/api/books/[id]` | 書籍詳細取得 |

### 6.3 本棚系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/shelves` | 本棚一覧取得 |
| POST | `/api/shelves` | 本棚作成 |
| GET | `/api/shelves/[id]` | 本棚詳細取得 |
| PUT | `/api/shelves/[id]` | 本棚更新 |
| DELETE | `/api/shelves/[id]` | 本棚削除 |
| GET | `/api/shelves/[id]/books` | 本棚内の本一覧取得 |

### 6.4 所有本系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| POST | `/api/owned-books` | 本を本棚に登録 |
| PUT | `/api/owned-books/[id]` | 所有本情報更新（読書状況等） |
| DELETE | `/api/owned-books/[id]` | 本棚から削除 |
| PATCH | `/api/owned-books/[id]/move` | 本を別の本棚に移動 |

### 6.5 欲しい本系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/wanted-books` | 欲しい本一覧取得 |
| POST | `/api/wanted-books` | 欲しい本登録 |
| DELETE | `/api/wanted-books/[id]` | 欲しい本削除 |
| POST | `/api/wanted-books/[id]/purchase` | 欲しい本を「未確定の本」に移動（ワンタッチ購入） |

### 6.6 未確定の本系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/unshelved-books` | 未確定の本一覧取得 |
| POST | `/api/unshelved-books` | 未確定の本登録 |
| PUT | `/api/unshelved-books/[id]` | 未確定の本更新（読書状況等） |
| DELETE | `/api/unshelved-books/[id]` | 未確定の本削除 |
| POST | `/api/unshelved-books/[id]/shelve` | 未確定の本を本棚に配置 |

### 6.7 読んだ本系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/read-books` | 読んだ本一覧取得 |
| POST | `/api/read-books` | 読んだ本登録 |
| DELETE | `/api/read-books/[id]` | 読んだ本削除 |

### 6.8 AI系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| POST | `/api/books/[id]/generate-review` | 自動感想生成 |
| GET | `/api/books/[id]/review` | 自動生成感想取得 |

### 6.9 検索系
| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | `/api/search?q=&type=&status=` | 統合検索 |

---

## 7. 外部API連携

### 7.1 Google Books API

| 項目 | 説明 |
|------|------|
| 用途 | ISBNから書籍情報を取得 |
| 取得データ | title, subtitle, authors, publisher, publishedDate, description, imageLinks, categories, pageCount |
| エンドポイント | `https://www.googleapis.com/books/v1/volumes?q=isbn:{ISBN}` |
| 認証 | APIキー |

### 7.2 SLM API（アドバンスド機能）

| 項目 | 説明 |
|------|------|
| 用途 | 本のタイトル・カテゴリから50字の感想を自動生成 |
| 入力 | 書籍タイトル、カテゴリ |
| 出力 | 50字程度の感想文 |

---

## 8. 非機能要件

### 8.1 パフォーマンス
- ページ読み込み時間: 3秒以内
- API応答時間: 500ms以内
- バーコード読み取り: 1秒以内

### 8.2 セキュリティ
- OAuth 2.0認証（Google経由）
- NextAuthによるセッション管理
- CSRF対策（NextAuth組み込み）
- SQLインジェクション対策（Prisma使用）
- APIキー・OAuth秘密鍵の環境変数管理

### 8.3 信頼性
- データのバックアップ機能
- エラーログの記録
- オフライン時の一時保存（PWA対応検討）

### 8.4 ユーザビリティ
- 直感的なUI設計
- 蔵書点検時の連続スキャン対応
- モバイルファーストデザイン

---

## 9. UI詳細仕様

### 9.1 ログインUI
```
┌─────────────────────────────────────┐
│                                     │
│           📚 本の管理               │
│                                     │
│    自宅の本を簡単に管理しよう       │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  🔵 Googleでログイン         │   │
│  └─────────────────────────────┘   │
│                                     │
│    ログインすると利用規約に         │
│    同意したことになります           │
│                                     │
└─────────────────────────────────────┘
```

### 9.2 ダッシュボードUI（トップ画面）
```
┌─────────────────────────────────────┐
│  📚 本の管理                        │
├─────────────────────────────────────┤
│                                     │
│  ⚠️ 未確定の本（3冊）               │
│  ┌─────────────────────────────┐   │
│  │ 📕 本A  [本棚に配置]         │   │
│  │ 📗 本B  [本棚に配置]         │   │
│  │ 📘 本C  [本棚に配置]         │   │
│  └─────────────────────────────┘   │
│                                     │
│  📖 本棚一覧                        │
│  ┌─────────────────────────────┐   │
│  │ リビング本棚      (25冊)     │   │
│  │ 書斎             (42冊)     │   │
│  │ 寝室              (8冊)     │   │
│  └─────────────────────────────┘   │
│                                     │
│  [+ 本棚を追加]                     │
│                                     │
└─────────────────────────────────────┘
```

### 9.3 欲しい本一覧UI
```
┌─────────────────────────────────────┐
│  💫 欲しい本（5冊）                  │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ 📕 欲しい本1    [購入した!]  │   │
│  │ 📗 欲しい本2    [購入した!]  │   │
│  │ 📘 欲しい本3    [購入した!]  │   │
│  └─────────────────────────────┘   │
│                                     │
│  [+ 欲しい本を追加]                 │
└─────────────────────────────────────┘
```
※「購入した!」ボタンでワンタッチで未確定の本に移動

### 9.4 本登録UI（シンプル版）
```
┌─────────────────────────────────────┐
│  本を登録                           │
├─────────────────────────────────────┤
│                                     │
│  [📷 バーコードをスキャン]           │
│                                     │
│  ────────────────────────────────   │
│                                     │
│  📖 スキャン結果:                    │
│  ┌─────────────────────────────┐   │
│  │ 📕 本のタイトル              │   │
│  │    著者名                    │   │
│  └─────────────────────────────┘   │
│                                     │
│  本棚: [選択してください ▼]         │
│        [+ 新規作成]                 │
│                                     │
│  [登録する]                         │
│                                     │
│  ──── ISBNがない本 ────             │
│  [手動で入力する]                   │
│                                     │
└─────────────────────────────────────┘
```
※通常フロー：バーコードスキャン → 本棚選択 → 登録（2ステップ）
※ISBNなし：タイトル・著者入力 → 本棚選択 → 登録

### 9.5 蔵書点検UI
```
┌─────────────────────────────────────┐
│  蔵書点検                           │
├─────────────────────────────────────┤
│  本棚: [リビング本棚 ▼] [+ 新規作成]│
│                                     │
│  [📷 バーコードをスキャン]           │
│                                     │
│  登録済み: 15冊                     │
│  ┌─────────────────────────────┐   │
│  │ 📖 本のタイトル1     [読了]  │   │
│  │ 📖 本のタイトル2     [未読]  │   │
│  │ 📖 本のタイトル3     [読書中]│   │
│  └─────────────────────────────┘   │
│                                     │
│  [点検完了]                         │
└─────────────────────────────────────┘
```

### 9.6 本詳細モーダル
```
┌─────────────────────────────────────┐
│  本の詳細                    [×]   │
├─────────────────────────────────────┤
│  ┌─────────┐                       │
│  │  表紙   │  タイトル             │
│  │  画像   │  サブタイトル         │
│  │         │  著者名               │
│  └─────────┘  出版社 / 出版日      │
│                                     │
│  ═══════ 編集可能 ═══════          │
│                                     │
│  本棚:     [リビング本棚 ▼]        │
│  読書状況: [未読 ▼]                 │
│  メモ:     [________________]      │
│            [________________]      │
│                                     │
│  ═══════════════════════════        │
│                                     │
│  📝 AI感想:                         │
│  「この本は〇〇について...」        │
│                                     │
│  [保存] [削除 ▼]                    │
└─────────────────────────────────────┘
```
※編集可能項目：本棚（場所）、読書状況、メモの3つのみ
※書籍情報（タイトル、著者等）は表示のみ（編集不可）

---

## 10. 今後の拡張候補（スコープ外）

以下の機能は初期リリースのスコープ外とし、将来的な拡張として検討する：

- 読書メモ・感想の手動入力機能
- 読書統計・グラフ表示
- 本の貸し借り管理
- 複数ユーザーでの本棚共有
- Amazonリンク連携
- エクスポート機能（CSV/PDF）
- PWA対応（オフライン機能）
- プッシュ通知（新刊情報等）
